## 관계 데이터 모델과 제약조건

### 기본 용어 정의
* 릴레이션: 2차원의 테이블
* 레코드, 투플: 릴레이션의 각 행
* 애트리뷰트: 릴레이션의 하나의 열
* 도메인: 한 애트리뷰트에 나타날 수 있는 값들의 집합
* 차수: 한 릴레이션의 애트리뷰트 수로 최소 1 이상이다. 
* 카디날리티: 릴레이션의 레코드/투플의 수로 최소 0 이상이다.
* Null 값: 알려지지 않음 등을 나타내기 위한 값으로 DBMS마다 Null을 표현하기 위해 다른 기호를 사용하고 있다. 
* 릴레이션 스키마: 릴레이션의 이름과 릴레이션의 애트리뷰트들의 집합 \ 
  릴레이션 이름(<u>애트리뷰트1</u>, 애트리뷰트2, ... , 애트리뷰트n) 로 표현한다. \
  이때 키로 사용되는 애트리뷰트는 밑줄을 그어 표현한다. 
* 릴레이션 인스턴스: 릴레이션에 언느 시점에 들어있는 레코드/투플들의 집합
* 관계 데이터베이스 스키마 (relational database schema) 는 하나이상의 릴레이션 스키마들로 이루어진다. 
* 관계 데이터베이스 인스턴스: 릴레이션 인스턴스들의 모임으로 구성

### 릴레이션의 키
1. 수퍼키
   - 한 릴레이션의 특정 투플을 고유하게 식별하는 하나 또는 하나이상의 애트리뷰트들의 집합
   - 투플을 고유하게 식별하는데 _꼭 필요하지 않은_ 애트리뷰트도 포함 가능


2. 후보키
   - 각 투플들을 고유하게 식별하는 최소한의 애트리뷰트들의 모임
   - 모든 릴레이션은 최소한 한 개 이상의 후보키가 있음

3. 기본키
    - 릴레이션에 후보키가 두개 이상 있으면 이중 하나를 기본키로 설정
    - ISBN값처럼 임의의 키를 부여해 기본키를 생성할 수도 있음

4. 대체키
    - 후보키 중 기본키로 선택되지 않은 키

5. 외래키
   - 어떤 릴레이션의 기본키를 참조하는 애트리뷰트
   - 외래키의 도메인은 참조되는 릴레이션의 기본키와 동일한 도메인을 가져야함
   - 외래키는 기본키를 구성하거나, 구성하지 않을 수 있음



### 무결성 제약조건
1. 데이터 무결성이란? 
   - 데이터의 정확성 또는 유효성을 의미

2. 도메인 제약조건
   - 각 애트리뷰트의 값은 반드시 원자값(하나의 값)이어야 함.

3. 키 제약조건
   - _키_ 는 중복된 값 못가짐

4. 기본키와 엔티티 무결성 제약조건(객체 무결성)
   - _기본키_ 는 어떤 애트리뷰트도 Null일수 없음

5. 외래키와 참조 무결성 제약조건
   - 참조 무결성 제약조건을 만족하기 위해서는 아래의 두가지 조건 중 하나 이상만 만족하면 됨
     - 외래키 값은 참조하는 레코드/투플의 기본키 값
     - 외래키가 릴레이션의 기본키를 구성하는 것이 아니면 null 값을 가질 수 있음


### 삽입, 삭제, 수정시 무결성 제약조건의 유지
데이터베이스에 대한 갱신 연산은 삽입/삭제/수정이 있고 이 연산들에 대해서 무결성 제약조건을 만족하도록 필요한 행동을 수행해야함

1. 삽입 연산에 대한 무결성 제약 조건 유지
    - 참조되는 릴레이션에 새로운 투플 삽입인 경우
        - 이 경우 참조 무결성 제약 조건을 위배하지 않음
        - 다른 조건들은 위배할 가능성 존재

    - 참조하는 릴레이션에 새로운 투플 삽입인 경우
        - 이 경우 모든 제약조건에 대해서 위배할 가능성 존재

2. 삭제 연산에 대한 무결성 제약 조건 유지
    - 참조되는 릴레이션의 투플 삭제인 경우
        - 이 경우 이 투플을 참조하던 투플에서 참조 무결성 제약조건을 위배하는 경우 발생 가능

    - 참조하는 릴레이션에 투플 삭제인 경우
        - 위배하는 조건이 없음
  
3. 수정 연산에 대한 무결성 제약 조건 유지
   - 수정하는 애트리뷰트가 기본키/외래키가 아닌 경우
     - 수정 연산으로 참조 무결성 제약조건 위배는 일어나지 않음
   - 수정하는 애트리뷰트가 기본키/외래키인 경우
     - 이 경우 새로운 기본키/외래키를 가진 투플을 삭제하고 새로 생성하는 행위와 유사하므로 삽입/삭제에서 발생하는 제약조건 위배 가능성 존재

4. 참조 무결성 제약조건을 만족시키기 위한 행위
   - 제한(restricted)
     - 위배를 하는 연산을 단순히 막음

   - 연쇄(cascade)
     - 참조되는 릴레이션에서 투플을 삭제할때 참조 무결성 제약조건이 위배되면, 이 투플을 삭제하면서 이를 참조하는 투플들도 모두 삭제

   - 널값(nullify)
     - 참조되는 릴레이션에서 투플을 삭제할때 참조 무결성 제약조건이 위배되면, 이 투플을 삭제하면서 이를 참조하는 투플들의 외래키에 Null 값을 삽입
  
   - 디폴트값(default)
     - 참조되는 릴레이션에서 투플을 삭제할때 참조 무결성 제약조건이 위배되면, 이 투플을 삭제하면서 이를 참조하는 투플들의 외래키에 default로 설정된 값을 삽입

